"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2128],{2128:(A,p,d)=>{d.r(p),d.d(p,{CreateEventPage:()=>T});var _=d(467),a=d(9420),g=d(2881),c=d(4341),e=d(1360),h=d(2022),E=d(3615),f=d(9609);const b=["dateModal"],k=["timeModal"],C=()=>[0,.6],P=()=>[0,.5];function M(r,u){1&r&&(e.j41(0,"ion-note",35),e.EFF(1," El t\xedtulo es requerido "),e.k0s())}function F(r,u){1&r&&(e.j41(0,"ion-note",35),e.EFF(1," La ubicaci\xf3n es requerida "),e.k0s())}function y(r,u){if(1&r){const s=e.RV6();e.j41(0,"ion-item")(1,"ion-label"),e.EFF(2),e.k0s(),e.j41(3,"ion-button",36),e.bIt("click",function(){const n=e.eBV(s).index,i=e.XpG();return e.Njj(i.removeActivity(n))}),e.nrm(4,"ion-icon",37),e.k0s()()}if(2&r){const s=u.$implicit;e.R7$(2),e.JRh(s)}}function j(r,u){1&r&&(e.j41(0,"ion-note",38),e.EFF(1," No hay actividades agregadas "),e.k0s())}function O(r,u){if(1&r){const s=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",6)(3,"ion-button",39),e.bIt("click",function(){e.eBV(s),e.XpG();const n=e.sdS(70);return e.Njj(n.dismiss(null,"cancel"))}),e.EFF(4,"Cancelar"),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Seleccionar Fecha"),e.k0s(),e.j41(7,"ion-buttons",40)(8,"ion-button",41),e.bIt("click",function(){e.eBV(s);const n=e.sdS(12);e.XpG();const i=e.sdS(70);return e.Njj(i.dismiss(n.value,"confirm"))}),e.EFF(9,"Confirmar"),e.k0s()()()(),e.j41(10,"ion-content"),e.nrm(11,"ion-datetime",42,3),e.k0s()}if(2&r){let s;const t=e.XpG();e.R7$(8),e.Y8G("strong",!0),e.R7$(3),e.Y8G("preferWheel",!0)("value",null==(s=t.eventForm.get("date"))?null:s.value)("min",t.minDate)}}function D(r,u){if(1&r){const s=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",6)(3,"ion-button",39),e.bIt("click",function(){e.eBV(s),e.XpG();const n=e.sdS(73);return e.Njj(n.dismiss(null,"cancel"))}),e.EFF(4,"Cancelar"),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Seleccionar Hora"),e.k0s(),e.j41(7,"ion-buttons",40)(8,"ion-button",41),e.bIt("click",function(){e.eBV(s);const n=e.sdS(12);e.XpG();const i=e.sdS(73);return e.Njj(i.dismiss(n.value,"confirm"))}),e.EFF(9,"Confirmar"),e.k0s()()()(),e.j41(10,"ion-content"),e.nrm(11,"ion-datetime",43,4),e.k0s()}if(2&r){let s;const t=e.XpG();e.R7$(8),e.Y8G("strong",!0),e.R7$(3),e.Y8G("value",null==(s=t.eventForm.get("time"))?null:s.value)}}let T=(()=>{var r;class u{constructor(t,n,i,o,l,m,v,I,S){this.formBuilder=t,this.eventService=n,this.supabase=i,this.router=o,this.alertController=l,this.toastController=m,this.route=v,this.cdr=I,this.datePipe=S,this.activities=[],this.isSubmitting=!1,this.minDate=(new Date).toISOString().split("T")[0],this.userId="",this.isEditMode=!1,this.pageTitle="Crear Nuevo Evento",this.formattedDate="",this.formattedTime="",this.eventId=null,this.eventForm=this.formBuilder.group({title:["",[c.k0.required,c.k0.minLength(3)]],description:[""],date:["",c.k0.required],time:["",c.k0.required],location:["",[c.k0.required,c.k0.minLength(3)]],max_guests:[null]})}ngOnInit(){var t=this;return(0,_.A)(function*(){t.eventId=t.route.snapshot.paramMap.get("id"),t.isEditMode=!!t.eventId,t.pageTitle=t.isEditMode?"Editar Evento":"Crear Nuevo Evento";const{data:{user:n}}=yield t.supabase.client.auth.getUser();n?(t.userId=n.id,t.isEditMode&&t.eventId&&t.loadEventForEdit(t.eventId)):t.router.navigateByUrl("/auth")})()}loadEventForEdit(t){var n=this;return(0,_.A)(function*(){const i=yield n.eventService.getEventById(t);if(i&&i.date&&i.time){const o=`${i.date}T${i.time}`;n.eventForm.patchValue({title:i.title,description:i.description,date:o,time:o,location:i.location,max_guests:i.max_guests}),n.activities=i.activities||[],n.formattedDate=n.datePipe.transform(o,"fullDate")||"",n.formattedTime=n.datePipe.transform(o,"h:mm a")||""}})()}addActivity(t){const n=String(null!=t?t:"").trim();n&&(this.activities.includes(n)||this.activities.push(n))}addActivityAndKeepFocus(t,n){var i;n&&(n.preventDefault(),n.stopPropagation());const o=String(null!==(i=t.value)&&void 0!==i?i:"").trim();o&&(this.activities.includes(o)||this.activities.push(o),t.value="",setTimeout(()=>{t.setFocus()},100))}handleActivityKeydown(t,n){("Enter"===t.key||13===t.keyCode)&&(t.preventDefault(),t.stopPropagation(),this.addActivityAndKeepFocus(n,t))}removeActivity(t){this.activities.splice(t,1)}presentDateModal(){var t=this;return(0,_.A)(function*(){t.dateModal.present();const{data:n,role:i}=yield t.dateModal.onDidDismiss();if("confirm"===i){var o;const l=n||(new Date).toISOString();null===(o=t.eventForm.get("date"))||void 0===o||o.setValue(l),t.formattedDate=t.datePipe.transform(l,"fullDate")||"",t.cdr.detectChanges()}})()}presentTimeModal(){var t=this;return(0,_.A)(function*(){t.timeModal.present();const{data:n,role:i}=yield t.timeModal.onDidDismiss();if("confirm"===i){var o;const l=n||(new Date).toISOString();null===(o=t.eventForm.get("time"))||void 0===o||o.setValue(l),t.formattedTime=t.datePipe.transform(l,"h:mm a")||"",t.cdr.detectChanges()}})()}createEvent(){var t=this;return(0,_.A)(function*(){yield t._submitForm()})()}_submitForm(){var t=this;return(0,_.A)(function*(){if(t.eventForm.invalid)yield t.showToast("Por favor, completa todos los campos requeridos.","warning");else{t.isSubmitting=!0;try{const n=t.eventForm.value,i=n.date?new Date(n.date).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0],o=n.time?new Date(n.time).toLocaleTimeString("en-GB"):"12:00:00",l={title:n.title,description:n.description||"",date:i,time:o,location:n.location,activities:t.activities,max_guests:n.max_guests||null};let m;if(m=t.isEditMode&&t.eventId?yield t.eventService.updateEvent(t.eventId,l):yield t.eventService.createEvent(l,t.userId,"active"),m){const v=t.isEditMode?"Evento actualizado!":"Evento creado!";yield t.showToast(v,"success"),t.eventForm.reset(),t.activities=[],t.router.navigateByUrl("/home")}else{const v=t.isEditMode?"Error al actualizar el evento":"Error al crear el evento";yield t.showToast(v,"danger")}}catch(n){console.error("Error saving event:",n);const i=t.isEditMode?"Error al actualizar el evento":"Error al crear el evento";yield t.showToast(i,"danger")}finally{t.isSubmitting=!1}}})()}showToast(t){var n=this;return(0,_.A)(function*(i,o="primary"){yield(yield n.toastController.create({message:i,duration:3e3,color:o,position:"top"})).present()}).apply(this,arguments)}confirmExit(){var t=this;return(0,_.A)(function*(){t.eventForm.dirty||t.activities.length>0?yield(yield t.alertController.create({header:"\xbfSalir sin guardar?",message:"Tienes cambios sin guardar. \xbfEst\xe1s seguro de que quieres salir?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Salir",handler:()=>{t.router.navigateByUrl("/home")}}]})).present():t.router.navigateByUrl("/home")})()}}return(r=u).\u0275fac=function(t){return new(t||r)(e.rXU(c.ok),e.rXU(h.U),e.rXU(E.w),e.rXU(f.Ix),e.rXU(a.hG),e.rXU(a.K_),e.rXU(f.nX),e.rXU(e.gRc),e.rXU(g.vh))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-create-event"]],viewQuery:function(t,n){if(1&t&&(e.GBs(b,5),e.GBs(k,5)),2&t){let i;e.mGM(i=e.lsd())&&(n.dateModal=i.first),e.mGM(i=e.lsd())&&(n.timeModal=i.first)}},features:[e.Jv_([g.vh])],decls:75,vars:17,consts:[["activityInput",""],["dateModal",""],["timeModal",""],["datePicker",""],["timePicker",""],[1,"ion-no-border"],["slot","start"],["defaultHref","/home","text",""],[1,"ion-text-center"],[3,"fullscreen"],[1,"content-container",3,"ngSubmit","formGroup"],[1,"centered-content"],[1,"ion-padding","main-grid"],["size","12"],[1,"detail-card"],[1,"section-header"],["position","stacked"],["formControlName","title","placeholder","Ej: Reuni\xf3n familiar...","type","text"],["color","danger",4,"ngIf"],["formControlName","description","placeholder","Describe tu evento...","rows","3"],["button","true",3,"click"],["readonly","true","placeholder","Selecciona una fecha",3,"value"],["readonly","true","placeholder","Selecciona una hora",3,"value"],["formControlName","location","placeholder","Ej: Parque Central, Restaurante XYZ","type","text"],["formControlName","max_guests","type","number","min","1","placeholder","Sin l\xedmite"],[3,"keydown"],["placeholder","Agregar actividad...",3,"keydown.enter"],["slot","end","fill","clear",3,"click"],["name","add"],[4,"ngFor","ngForOf"],["color","medium",4,"ngIf"],[1,"action-buttons"],["expand","block","type","submit",3,"disabled"],["name","create-outline","slot","start"],[3,"initialBreakpoint","breakpoints"],["color","danger"],["slot","end","fill","clear","color","danger",3,"click"],["name","trash"],["color","medium"],[3,"click"],["slot","end"],[3,"click","strong"],["presentation","date",3,"preferWheel","value","min"],["presentation","time",3,"value"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"ion-header",5)(1,"ion-toolbar")(2,"ion-buttons",6),e.nrm(3,"ion-back-button",7),e.k0s(),e.j41(4,"ion-title",8),e.EFF(5),e.k0s()()(),e.j41(6,"ion-content",9)(7,"form",10),e.bIt("ngSubmit",function(){return e.eBV(i),e.Njj(n.createEvent())}),e.j41(8,"div",11)(9,"ion-grid",12)(10,"ion-row")(11,"ion-col",13)(12,"ion-card",14)(13,"div",15)(14,"h2"),e.EFF(15,"Informaci\xf3n del Evento"),e.k0s(),e.j41(16,"p"),e.EFF(17,"Completa los detalles de tu reuni\xf3n"),e.k0s()(),e.j41(18,"ion-card-content")(19,"ion-item")(20,"ion-label",16),e.EFF(21,"T\xedtulo del Evento *"),e.k0s(),e.nrm(22,"ion-input",17),e.k0s(),e.DNE(23,M,2,0,"ion-note",18),e.j41(24,"ion-item")(25,"ion-label",16),e.EFF(26,"Descripci\xf3n"),e.k0s(),e.nrm(27,"ion-textarea",19),e.k0s(),e.j41(28,"ion-item",20),e.bIt("click",function(){return e.eBV(i),e.Njj(n.presentDateModal())}),e.j41(29,"ion-label",16),e.EFF(30,"Fecha *"),e.k0s(),e.nrm(31,"ion-input",21),e.k0s(),e.j41(32,"ion-item",20),e.bIt("click",function(){return e.eBV(i),e.Njj(n.presentTimeModal())}),e.j41(33,"ion-label",16),e.EFF(34,"Hora *"),e.k0s(),e.nrm(35,"ion-input",22),e.k0s(),e.j41(36,"ion-item")(37,"ion-label",16),e.EFF(38,"Ubicaci\xf3n *"),e.k0s(),e.nrm(39,"ion-input",23),e.k0s(),e.DNE(40,F,2,0,"ion-note",18),e.j41(41,"ion-item")(42,"ion-label",16),e.EFF(43,"N\xfamero m\xe1ximo de invitados"),e.k0s(),e.nrm(44,"ion-input",24),e.k0s()()()(),e.j41(45,"ion-col",13)(46,"ion-card",14)(47,"div",15)(48,"h2"),e.EFF(49,"Actividades"),e.k0s(),e.j41(50,"p"),e.EFF(51,"Agrega las actividades que se realizar\xe1n"),e.k0s()(),e.j41(52,"ion-card-content")(53,"div",25),e.bIt("keydown",function(l){e.eBV(i);const m=e.sdS(56);return e.Njj(n.handleActivityKeydown(l,m))}),e.j41(54,"ion-item")(55,"ion-input",26,0),e.bIt("keydown.enter",function(l){e.eBV(i);const m=e.sdS(56);return e.Njj(n.addActivityAndKeepFocus(m,l))}),e.k0s(),e.j41(57,"ion-button",27),e.bIt("click",function(){e.eBV(i);const l=e.sdS(56);return e.Njj(n.addActivityAndKeepFocus(l))}),e.nrm(58,"ion-icon",28),e.k0s()()(),e.j41(59,"ion-list"),e.DNE(60,y,5,1,"ion-item",29),e.k0s(),e.DNE(61,j,2,0,"ion-note",30),e.k0s()()(),e.j41(62,"ion-col",13)(63,"ion-grid",31)(64,"ion-row")(65,"ion-col")(66,"ion-button",32),e.nrm(67,"ion-icon",33),e.EFF(68),e.k0s()()()()()()()()(),e.j41(69,"ion-modal",34,1),e.DNE(71,O,13,4,"ng-template"),e.k0s(),e.j41(72,"ion-modal",34,2),e.DNE(74,D,13,2,"ng-template"),e.k0s()()}if(2&t){let i,o;e.R7$(5),e.JRh(n.pageTitle),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("formGroup",n.eventForm),e.R7$(16),e.Y8G("ngIf",(null==(i=n.eventForm.get("title"))?null:i.invalid)&&(null==(i=n.eventForm.get("title"))?null:i.touched)),e.R7$(8),e.Y8G("value",n.formattedDate),e.R7$(4),e.Y8G("value",n.formattedTime),e.R7$(5),e.Y8G("ngIf",(null==(o=n.eventForm.get("location"))?null:o.invalid)&&(null==(o=n.eventForm.get("location"))?null:o.touched)),e.R7$(20),e.Y8G("ngForOf",n.activities),e.R7$(),e.Y8G("ngIf",0===n.activities.length),e.R7$(5),e.Y8G("disabled",n.eventForm.invalid||n.isSubmitting),e.R7$(2),e.SpI(" ",n.isSubmitting?n.isEditMode?"Actualizando...":"Creando...":n.isEditMode?"Actualizar Evento":"Crear Evento"," "),e.R7$(),e.Y8G("initialBreakpoint",.6)("breakpoints",e.lJ4(15,C)),e.R7$(3),e.Y8G("initialBreakpoint",.5)("breakpoints",e.lJ4(16,P))}},dependencies:[a.bv,a.Jm,a.QW,a.b_,a.I9,a.hU,a.W9,a.A9,a.lO,a.eU,a.iq,a.$w,a.uz,a.he,a.nf,a.JI,a.ln,a.nc,a.BC,a.ai,a.Sb,a.su,a.Je,a.Gw,a.el,a.T6,g.MD,g.Sq,g.bT,c.X1,c.qT,c.BC,c.cb,c.j4,c.JD],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{margin-top:0}.content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100%}.centered-content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;flex:1;max-width:800px;margin:0 auto;padding:0 16px}.main-grid[_ngcontent-%COMP%]{width:100%}.main-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{margin-bottom:16px}.main-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:last-child{margin-bottom:0}.detail-card[_ngcontent-%COMP%]{background:#2c2c2e;border-radius:12px;margin:0;color:#f5f5f5;height:100%;box-shadow:0 4px 12px #0000004d}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{border-bottom:1px solid #444}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:last-child{border-bottom:none}ion-list[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden;background:#2c2c2e}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--color: #f5f5f5;border-bottom:1px solid #999}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[name=trash][_ngcontent-%COMP%]{color:#eb445a}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #0f0c29, #302b63, #24243e)}.action-buttons[_ngcontent-%COMP%]{margin-top:16px}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: transparent;--border-color: #667eea;--border-width: 1px;--border-style: solid;--color: #667eea;--border-radius: 8px;font-weight:500;text-transform:none;margin-bottom:8px}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:hover{--background: rgba(102, 126, 234, .1)}.form-grid[_ngcontent-%COMP%]{padding-top:16px}@media (max-width: 768px){.centered-content[_ngcontent-%COMP%]{padding:0 8px;max-width:100%}.main-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{margin-bottom:12px}}']}),u})()}}]);