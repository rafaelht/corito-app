"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6980],{6980:(v,_,s)=>{s.r(_),s.d(_,{ProfilePage:()=>k});var d=s(467),p=s(2881),l=s(4341),t=s(9420),e=s(1360),m=s(3615),g=s(9609);function f(r,u){1&r&&(e.j41(0,"div",7),e.nrm(1,"ion-spinner",8),e.k0s())}function b(r,u){1&r&&(e.j41(0,"ion-note",27),e.EFF(1," El nombre de usuario es requerido. "),e.k0s())}function P(r,u){1&r&&(e.j41(0,"ion-note",27),e.EFF(1," Debe tener al menos 3 caracteres. "),e.k0s())}function h(r,u){if(1&r&&(e.j41(0,"div",25),e.DNE(1,b,2,0,"ion-note",26)(2,P,2,0,"ion-note",26),e.k0s()),2&r){let i,n;const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",null==(i=o.profileForm.get("username"))||null==i.errors?null:i.errors.required),e.R7$(),e.Y8G("ngIf",null==(n=o.profileForm.get("username"))||null==n.errors?null:n.errors.minlength)}}function E(r,u){if(1&r){const i=e.RV6();e.j41(0,"ion-grid")(1,"ion-row",9)(2,"ion-col",10)(3,"div",11)(4,"ion-avatar"),e.nrm(5,"ion-icon",12),e.k0s(),e.j41(6,"ion-button",13),e.EFF(7,"(Editar foto)"),e.k0s()(),e.j41(8,"form",14),e.bIt("ngSubmit",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.updateProfile())}),e.j41(9,"ion-item")(10,"ion-label",15),e.EFF(11,"Email"),e.k0s(),e.nrm(12,"ion-input",16),e.k0s(),e.j41(13,"ion-item")(14,"ion-label",15),e.EFF(15,"Nombre de Usuario"),e.k0s(),e.nrm(16,"ion-input",17),e.k0s(),e.DNE(17,h,3,2,"div",18),e.j41(18,"ion-item")(19,"ion-label",15),e.EFF(20,"Nombre"),e.k0s(),e.nrm(21,"ion-input",19),e.k0s(),e.j41(22,"ion-item")(23,"ion-label",15),e.EFF(24,"Apellido"),e.k0s(),e.nrm(25,"ion-input",20),e.k0s(),e.j41(26,"ion-item")(27,"ion-label",15),e.EFF(28,"Sitio Web"),e.k0s(),e.nrm(29,"ion-input",21),e.k0s(),e.j41(30,"ion-button",22),e.EFF(31," Actualizar Perfil "),e.k0s()(),e.j41(32,"div",23)(33,"ion-button",24),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.signOut())}),e.EFF(34," Cerrar Sesi\xf3n "),e.k0s()()()()()}if(2&r){let i;const n=e.XpG();e.R7$(8),e.Y8G("formGroup",n.profileForm),e.R7$(4),e.Y8G("value",n.userEmail),e.R7$(5),e.Y8G("ngIf",(null==(i=n.profileForm.get("username"))?null:i.invalid)&&(null==(i=n.profileForm.get("username"))?null:i.touched)),e.R7$(13),e.Y8G("disabled",n.profileForm.invalid)}}let k=(()=>{var r;class u{constructor(n,o,a,c,C){this.supabase=n,this.fb=o,this.toastController=a,this.loadingController=c,this.router=C,this.userEmail="",this.isLoading=!0,this.userId="",this.profileForm=this.fb.group({username:["",[l.k0.required,l.k0.minLength(3)]],first_name:[""],last_name:[""],website:[""]})}ngOnInit(){this.loadProfile()}loadProfile(){var n=this;return(0,d.A)(function*(){n.isLoading=!0;try{const{data:{user:o}}=yield n.supabase.client.auth.getUser();if(o){n.userId=o.id,n.userEmail=o.email;const{data:a,error:c}=yield n.supabase.client.from("profiles").select("*").eq("id",n.userId).single();if(c&&"PGRST116"!==c.code)throw c;a&&n.profileForm.patchValue({username:a.username,first_name:a.first_name,last_name:a.last_name,website:a.website})}}catch{n.showToast("Error al cargar el perfil.","danger")}finally{n.isLoading=!1}})()}updateProfile(){var n=this;return(0,d.A)(function*(){const o=yield n.loadingController.create();yield o.present();try{const a={id:n.userId,...n.profileForm.value,updated_at:new Date},{error:c}=yield n.supabase.client.from("profiles").upsert(a);if(c)throw c;n.showToast("Perfil actualizado con \xe9xito.","success")}catch{n.showToast("Error al actualizar el perfil.","danger")}finally{o.dismiss()}})()}signOut(){var n=this;return(0,d.A)(function*(){yield n.supabase.client.auth.signOut(),n.router.navigateByUrl("/auth",{replaceUrl:!0})})()}showToast(n,o){var a=this;return(0,d.A)(function*(){yield(yield a.toastController.create({message:n,duration:3e3,color:o})).present()})()}}return(r=u).\u0275fac=function(n){return new(n||r)(e.rXU(m.w),e.rXU(l.ok),e.rXU(t.K_),e.rXU(t.Xi),e.rXU(g.Ix))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-profile"]],decls:9,vars:3,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","/home","text",""],[1,"ion-text-center"],[3,"fullscreen"],["class","ion-text-center ion-padding",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-padding"],["name","crescent"],[1,"ion-justify-content-center"],["size","12","size-md","8","size-lg","6"],[1,"top-section"],["name","person-circle",1,"fallback-avatar"],["fill","clear","size","small",1,"edit-avatar-btn"],[1,"ion-padding",3,"ngSubmit","formGroup"],["position","stacked"],["readonly","true","color","medium",3,"value"],["formControlName","username","placeholder","Tu nombre de usuario","required",""],["class","error-message",4,"ngIf"],["formControlName","first_name","placeholder","Tu nombre"],["formControlName","last_name","placeholder","Tu apellido"],["formControlName","website","placeholder","https://tu-web.com"],["expand","block","type","submit",1,"ion-margin-top","update-button",3,"disabled"],[2,"padding-top","8px"],["expand","block","fill","outline","color","danger",1,"sign-out-button",3,"click"],[1,"error-message"],["color","danger",4,"ngIf"],["color","danger"]],template:function(n,o){1&n&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title",3),e.EFF(5,"Perfil"),e.k0s()()(),e.j41(6,"ion-content",4),e.DNE(7,f,2,0,"div",5)(8,E,35,4,"ion-grid",6),e.k0s()),2&n&&(e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("ngIf",o.isLoading),e.R7$(),e.Y8G("ngIf",!o.isLoading))},dependencies:[t.bv,t.mC,t.Jm,t.QW,t.hU,t.W9,t.lO,t.eU,t.iq,t.$w,t.uz,t.he,t.JI,t.ln,t.w2,t.BC,t.ai,t.Gw,t.el,p.MD,p.bT,l.YN,l.qT,l.BC,l.cb,l.YS,l.X1,l.j4,l.JD],styles:['@charset "UTF-8";ion-header[_ngcontent-%COMP%]{--background: transparent;background:transparent}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;background:transparent}ion-header[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:#e0e0e0;font-weight:600;font-size:1.2rem;text-align:center!important;position:absolute!important;left:0!important;right:0!important;margin:0 auto!important}.top-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:0;margin-top:-10px}.top-section[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:80px;height:80px;border:3px solid rgba(102,126,234,.7);padding:3px;background:#2c2c2e80;display:flex;align-items:center;justify-content:center}.top-section[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]   .fallback-avatar[_ngcontent-%COMP%]{font-size:80px;color:#667eeae6;display:flex;align-items:center;justify-content:center}.top-section[_ngcontent-%COMP%]   .edit-avatar-btn[_ngcontent-%COMP%]{--color: #a0a0a0;text-transform:none;font-weight:500}form[_ngcontent-%COMP%]{background:#2c2c2ecc;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-radius:20px;border:1px solid rgba(255,255,255,.1);padding-bottom:16px}ion-item[_ngcontent-%COMP%]{margin:8px 16px 16px}.update-button[_ngcontent-%COMP%]{margin:16px;width:calc(100% - 32px);--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}.sign-out-button[_ngcontent-%COMP%]{--border-color: #eb445a;--color: #eb445a}']}),u})()}}]);